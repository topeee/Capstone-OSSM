<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senior Citizen ID Replacement Form</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

    <style>
        body {
            background-color: white;
            font-size: 18px; /* Adjusting font size to 18px */
            font-family: Georgia, 'Times New Roman', Times, serif;
        }

        .container {
            max-width: 800px;
            background-color: rgb(0, 0, 0);
            padding: 30px;
            margin-top: 50px;
            border-radius: 10px;
        }

        .border-wrapper {
            border: 2px solid rgb(0, 0, 0); /* Adding a 2px black border */
            padding: 20px; /* Optional: Add padding inside the border */
            border-radius: 10px; /* Optional: round the corners */
        }

        h1,
        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .line {
            border-bottom: 1px solid black;
            display: inline-block;
            width: 100%;
        }

        .label {
            font-weight: bold;
        }

        .form-row {
            margin-bottom: 15px;
        }

        .table-bordered th,
        .table-bordered td {
            vertical-align: middle;
            text-align: center;
        }

        p,
        span,
        ul,
        li {
            font-size: 18px; /* Consistent font size */
        }
        .button-card {
        position: fixed;
        top: 50%;
        right: 20px;
        width: 250px;
        transform: translateY(-50%);
        padding: 20px;
        border: 2px solid black;
        background-color: white;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .button-card button {
        width: 100%;
        margin-top: 10px;
        }
        .container.border-wrapper {
            background-color: transparent;
        }
        .family-composition {
            border-color: black; /* Change this to your desired color */
        }
        
        @media print {
        .button-card {
            display: none;
        }
        }


    </style>
</head>

<body>
    <div class="container border-wrapper"> <!-- Added a wrapper div with border -->
        <div class="text-center">
            <img src="headerSenior.png" alt="Municipality header" style="max-width: 1050px; padding-right: 310px;">
        </div>

        <p style="font-weight: bold; text-align: center;">Senior Citizen’s Replacement ID Form </p>

        <div class="form-row">
            <span class="label last-field first-field middle-field" >Name:______________________________________________________</span>

            <div class="text-center" style="font-size: 20px;">
                <strong style="margin-right: 100px;">Surname,</strong>
                <strong style="margin-right: 100px;" >First Name,</strong>
                <strong >Middle Name</strong>
            </div>
        </div>

        <div class="form-row">
            <div class="row">
                <div class="col-md-4">
                    <span class="label birth-field">Date of Birth:________</span>
                </div>
                <div class="col-md-2">
                    <span class="label age-field">Age:____</span>
                </div>
                <div class="col-md-2" style="padding-right: 11px;">
                    <span class="label gender-field">Sex:_____</span>
                </div>
                <div class="col-md-4">
                    <span class="label civil-field">Civil Status:_________</span>
                </div>
            </div>
        </div>

        <div class="form-row">
            <span class="label address-field">Address:____________________________________________________</span>
            <div class="line"></div>
        </div>

        <div class="form-row">
            <div class="row">
                <div class="col-md-6">
                    <span class="label place-field">Place of Birth:________________</span>
                </div>
                <div class="col-md-5">
                    <span class="label occupation-field">Occupation:________________</span>

                </div>
            </div>
        </div>

        <div class="form-row">
            <span class="label contact-field">Contact Number:________________</span>

        </div>

        <div class="form-row">
            <span class="label reason-field">Reason for Replacement:________________________________________</span>
        </div>

        <div class="form-row">
            <span class="label loss-field">If loss, when:________________________________________________</span>
        </div>

        <div class="form-row">
            <h5><strong>In Case of Emergency, Notify:</strong></h5>
            <span class="label emergencyFname-field emergencyMname-field emergencyLname-field">Name:______________________________________________________</span>

            <span class="label emergencyContact-field">Contact No.:__________________________</span>

        </div>

        <div class="form-row">
            <h5 class="text-center"><strong><u>Family Composition</u></strong></h5>
            <table class="table table-bordered">
                <thead class="table">
                    <tr>
                        <th style="width: 20%;">Name</th>
                        <th style="width: 20%;">Relationship</th>
                        <th style="width: 15%;">Age</th>
                        <th style="width: 20%;">Civil Status</th>
                        <th style="width: 25%;">Occupation</th>
                    </tr>
                </thead>
                <tbody class="table table-bordered thin-rows">

                </tbody>
            </table>
        </div>

        <div class="text-center">
            <p style="font-size: 11px;"><strong><u>(Use other side of this form if necessary)</u></strong><br>
                <strong>I hereby certify that the above information are true and correct to the best of my knowledge and belief</strong></p>
        </div>

        <div class="form-row">
            <div class="row">
                <!-- Requirements Section (Left) -->
                <div class="col-md-6">
                    <h4 style="margin-top: 70px;">Requirements</h4>
                    <ul>
                        <li style="font-size: 17px;">Birth Certificate or Baptismal Certificate</li>
                        <li style="font-size: 17px;">1 Pc. 1x1 Recent Picture</li>
                        <li style="font-size: 17px;">Any two (2) Valid Ids (SSS ID, Voter’s Id,
                            Driver’s License, Passport ID, Postal ID)</li>
                        <li style="font-size: 17px;">Barangay Certificate of Residency </li>
                    </ul>
                </div>

                <!-- Signature Section (Right) -->
                <div class="col-md-6 text-center" style="margin-top: 100px;">
                    <div class="line"></div>
                    <p class="small">(Signature / Thumb mark)</p>

                    <div class="line" style="margin-top: 70px;"></div>
                    <p class="small">(Signature over printed name of the Representative)</p>
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="row justify-content-between">
                <!-- Evaluated by Section (Left) -->
                <div class="col-md-5" style="margin-left: 20px;">
                    <h4 style="font-size: 15px; font-weight: bold;">Evaluated by:</h4>
                    <br><br><br>
                    <p style="font-size: 15px; text-align: center; font-weight: bold;">JAMES JOSEPH P. OPIDER, RSW</p>
                    <hr style="border-top: 3px solid black;">
                    <p style="font-size: 15px; text-align: center;">OIC - MSWDO</p>
                </div>

                <!-- Approved by Section (Right) -->
                <div class="col-md-5 text-end" style="margin-right: 20px;">
                    <h4 style="font-size: 15px; text-align: left; font-weight: bold;">Approved by:</h4>
                    <br><br><br>
                    <p style="font-size: 15px; text-align: center; font-weight: bold;">HON. BARTOLOME N. RIVERA, JR.</p>
                    <hr style="border-top: 3px solid black;">
                    <p style="font-size: 15px; text-align: center;">Municipal Mayor</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Right-side Button Card -->
<div class="button-card">
 <button class="btn btn-primary" onclick="handleSubmit()">Submit</button>
 <button class="btn btn-success" onclick="handleDownload()">Submit and Download</button>
 <button class="btn btn-warning" onclick="handlePrint()">Download and Print</button>
</div>

<script>
async function handleDownload() {
    try {
        const { jsPDF } = window.jspdf;
        if (!jsPDF) {
            throw new Error("jsPDF is not loaded.");
        }

        // Select the element to capture
        const element = document.querySelector('.container.border-wrapper');
        if (!element) {
            throw new Error("Element not found.");
        }

        // Use html2canvas to capture the element, scaled down to fit the page
        const canvas = await html2canvas(element, { scale: 1 }); // Using scale: 1 for initial capture

        // Create a new jsPDF instance
        const pdf = new jsPDF('p', 'mm', 'a4');
        const pageWidth = 210; // A4 page width in mm
        const pageHeight = 297; // A4 page height in mm

        // Calculate the scaling factor to fit the content onto one page
        const imgWidth = canvas.width;
        const imgHeight = canvas.height;
        const ratio = Math.min(pageWidth / imgWidth, pageHeight / imgHeight);

        // Calculate the final dimensions
        const finalWidth = imgWidth * ratio;
        const finalHeight = imgHeight * ratio;

        // Convert the canvas to a base64 image
        const imgData = canvas.toDataURL('image/png');

        // Center the content on the page
        const xOffset = (pageWidth - finalWidth) / 2;
        const yOffset = (pageHeight - finalHeight) / 2;

        // Add the image to the PDF with the adjusted dimensions
        pdf.addImage(imgData, 'PNG', xOffset, yOffset, finalWidth, finalHeight);

        // Save the PDF with an appropriate filename
        pdf.save('Senior_Citizen_ID_Replacement_Form.pdf');
    } catch (error) {
        console.error('Error generating PDF:', error);
        alert('An error occurred while generating the PDF.');
    }
}


  function handleSubmit() {
    alert('Form Submitted');
  }

  function handlePrint() {
    window.print();
    window.download();
}

  document.addEventListener('DOMContentLoaded', function() {
    const firstNameValue = localStorage.getItem('summaryFirstName') || 'N/A';
    const middleNameValue = localStorage.getItem('summaryMiddleName') || 'N/A';
    const lastNameValue = localStorage.getItem('summaryLastName') || 'N/A';
    const dateOfBirthValue = localStorage.getItem('summaryDob') || 'N/A';
    const placeOfBirthValue = localStorage.getItem('summaryBirthPlace') || 'N/A';
    const genderValue = localStorage.getItem('summaryGender') || 'N/A';
    const civilStatusValue = localStorage.getItem('summaryCivilStatus') || 'N/A';
    const ageValue = localStorage.getItem('summaryAge') || 'N/A';
    const addressValue = localStorage.getItem('summaryAddress') || 'N/A';
    const occupationValue = localStorage.getItem('summaryOccupation') || 'N/A';
    const telephoneNumberValue = localStorage.getItem('summaryTele') || 'N/A';
    const phoneNumberValue = localStorage.getItem('summaryPhone') || 'N/A';
    const reasonForReplacementValue = localStorage.getItem('summaryReason') || 'N/A';
    const lossDateValue = localStorage.getItem('summaryLoss') || 'N/A';
    const emergencyFirstNameValue = localStorage.getItem('summaryEmergencyFirstName') || 'N/A';
    const emergencyMiddleNameValue = localStorage.getItem('summaryEmergencyMiddleName') || 'N/A';
    const emergencyLastNameValue = localStorage.getItem('summaryEmergencyLastName') || 'N/A';
    const emergencyContactNumberValue = localStorage.getItem('summaryEmergencyContact') || 'N/A';    

    document.querySelector('.last-field, first-field, middle-field').textContent = `Name:_____${lastNameValue}________${firstNameValue}___________${middleNameValue}______`;
    document.querySelector('.birth-field').textContent = `Date of Birth:  ${dateOfBirthValue}`;
    document.querySelector('.age-field').textContent = `Age:   ${ageValue}`;
    document.querySelector('.gender-field').textContent = `Sex: ${genderValue}`;
    document.querySelector('.civil-field').textContent = `Civil Status: ${civilStatusValue}`;
    document.querySelector('.address-field').textContent = `Address: ${addressValue}`;
    document.querySelector('.place-field').textContent = `Place of Birth: ${placeOfBirthValue}`;
    document.querySelector('.contact-field').textContent = `Contact Number: ${telephoneNumberValue}`;
    document.querySelector('.occupation-field').textContent = `Occupation: ${occupationValue}`;
    document.querySelector('.reason-field').textContent = `Reason for Replacement: ${reasonForReplacementValue}`;
    document.querySelector('.loss-field').textContent = `If loss, when: ${lossDateValue}`;
    document.querySelector('.emergencyFname-field').textContent = `Name: ${emergencyLastNameValue}____${emergencyFirstNameValue}____${emergencyMiddleNameValue}___ `;
    document.querySelector('.emergencyContact-field').textContent = `Contact No.: ${emergencyContactNumberValue}`;

  });

  document.addEventListener('DOMContentLoaded', function() {
    const familyData = JSON.parse(localStorage.getItem("familyData")) || [];
    const tableBody = document.querySelector(".thin-rows");

    familyData.forEach(member => {
        const newRow = document.createElement("tr");

        const relationshipCell = document.createElement("td");
        relationshipCell.textContent = member.relationship;
        newRow.appendChild(relationshipCell);

        const fullNameCell = document.createElement("td");
        fullNameCell.textContent = member.fullName;
        newRow.appendChild(fullNameCell);

        const birthDateCell = document.createElement("td");
        birthDateCell.textContent = member.birthDate;
        newRow.appendChild(birthDateCell);

        const civilStatusCell = document.createElement("td");
        civilStatusCell.textContent = member.civilStatus;
        newRow.appendChild(civilStatusCell);

        const occupationCell = document.createElement("td");
        occupationCell.textContent = member.occupation;
        newRow.appendChild(occupationCell);

        tableBody.appendChild(newRow);
    });
});
</script>
</body>

</html>
