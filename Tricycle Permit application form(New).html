<!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
      <link rel="stylesheet" href="bootstrap.min.css">
      <link rel="stylesheet" href="bootstrap.min.js">
      <link rel="stylesheet" href="Footer.Clean.icons.css">
      <link rel="stylesheet" href="pwd app.css">
      <link rel="icon" type="img/png" href="logo.png">
      <title>Tricycle Permit Application(New)</title>


      <style>

        #sig-canvas {
			border: 2px solid #CCCCCC;
			border-radius: 5px;
			cursor: crosshair;     
		}
		#sig-dataUrl {
			width: 100%;
		}
      </style>


    </head>
    <body>
      <nav class="navbar navbar-dark navbar-expand-lg">
        <div class="container-fluid">
          <a class="navbar-brand" href="index.php">
            <img class="navbar-brand-logo" alt="Logo" src="logo.png" width="110" height="110">
            <span class="brand-name">OSSM</span>
          </a>
          <div class="d-flex align-items-center ms-auto">
            <span class="username">Hello, Username</span>
            <div class="dropdown-center ms-3">
              <a class="btn btn-secondary dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <img class="Hamburger-Icon" src="Burger icon.png" alt="Burger Icon" width="36" height="36">
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="account_profile.html">Profile</a></li>
                <li><a class="dropdown-item" href="#">History Transaction</a></li>
                <li><a class="dropdown-item logout-item" href="login.html">Logout</a></li>
              </ul>
            </div>
          </div>
        </div>
      </nav>

      <br>

    <main class="p-4 mx-auto" style="width: 70%; height: 10%; background-color: rgb(227, 249, 255);">
      <div class="container">
        <div class="row">
            <!-- Button to toggle progress sidebar -->
            <button id="progress-button" class="btn btn-primary mb-3 d-md-none">Toggle Progress</button>
    
            <!-- Sidebar -->
            <div id="progress-menu" class="col-md-3 progress-sidebar hidden-xs" style="background-color: rgb(227, 249, 255);">
                <h4 class="text-center">Progress</h4>
                <ul>
                    <li class="progress-item active" data-target="identificationDocuments">
                        <a href="#">
                            Identification Documents
                            <i class="bi bi-check-square-fill"></i>
                        </a>
                    </li>
                    <li class="progress-item" data-target="communityandLocalGovernmentDocuments">
                        <a href="#">
                            Community and Local Government Documents
                            <i class="bi bi-check-square"></i>
                        </a>
                    </li>
                    <li class="progress-item" data-target="legalandCourtRelatedDocuments">
                        <a href="#">
                            Legal and Court-Related Documents
                            <i class="bi bi-check-square"></i>
                        </a>
                    </li>
                    <li class="progress-item" data-target="businessandOperationalDocuments">
                        <a href="#">
                            Business and Operational Documents
                            <i class="bi bi-check-square"></i>
                        </a>
                    </li>
                    <li class="progress-item" data-target="section6">
                        <a href="#">
                            Summary of Information
                            <i class="bi bi-check-square"></i>
                        </a>
                    </li>
                </ul>
            </div>
    
            <!-- Main form -->
            <div class="col-md-9">
                <div class="form-section" id="identificationDocuments">
                    <h4>Identification Documents</h4>
                    <p class="alert alert-info">
                        A separate application must be filed for each person seeking assistance. This is for Occupational Permit Only.
                    </p>
                    <form>
                        <div class="mb-2">
                                <label for="nbiImageUpload" class="form-label">Driver’s License</label>
                                <input type="file" class="form-control" id="nbiImageUpload" >
                                <button type="button" class="btn btn-primary mt-4" onclick="viewFile()">View Uploaded File</button>
                        </div>
                        <div class="mb-2">
                            <label for="nbiImageUpload" class="form-label">2x2 Operator’s Picture</label>
                            <input type="file" class="form-control" id="nbiImageUpload" >
                            <button type="button" class="btn btn-primary mt-4" onclick="viewFile()">View Uploaded File</button>
                        </div>

                        <br>

                        <div class="col-lg-offset-0 col-lg-12 col-xs-12"> 
                            <i class="bi bi-info-circle-fill"></i>       
                            *Note:  File type should be JPG, JPEG, or PNG and 7MB maximum file size.
                        </div>
                    </form>
                </div>
    


                <div class="form-section" id="communityandLocalGovernmentDocuments" style="display: none;">
                    <form>
                        <h4>Community and Local Government Documents</h4>
                        <div class="mb-3">
                            <label for="nbiImageUpload" class="form-label">Community Tax Certificate</label>
                            <input type="file" class="form-control" id="nbiImageUpload" >
                            <button type="button" class="btn btn-primary mt-4" onclick="viewFile()">View Uploaded File</button>
                        </div>
                        <div class="mb-3">
                            <label for="nbiImageUpload" class="form-label">Barangay Clearance</label>
                            <input type="file" class="form-control" id="nbiImageUpload" >
                            <button type="button" class="btn btn-primary mt-4" onclick="viewFile()">View Uploaded File</button>
                        </div>
                        <div class="mb-3">
                            <label for="nbiImageUpload" class="form-label">Voter’s Certificate</label>
                            <input type="file" class="form-control" id="nbiImageUpload" >
                            <button type="button" class="btn btn-primary mt-4" onclick="viewFile()">View Uploaded File</button>
                        </div>
                        <div class="mb-3">
                            <label for="nbiImageUpload" class="form-label">Certificate of Registration (Photo Copy)</label>
                            <input type="file" class="form-control" id="nbiImageUpload" >
                            <button type="button" class="btn btn-primary mt-4" onclick="viewFile()">View Uploaded File</button>
                        </div>

                        <br>

                        <div class="col-lg-offset-0 col-lg-12 col-xs-12"> 
                            <i class="bi bi-info-circle-fill"></i>       
                            *Note:  File type should be JPG, JPEG, or PNG and 7MB maximum file size.
                        </div>
                    </form>
                </div>



                <div class="form-section" id="legalandCourtRelatedDocuments" style="display: none;">
                    <form>
                        <h4>Legal and Court-Related Documents</h4>

                        <div class="mb-3">
                            <label for="nbiImageUpload" class="form-label">Police Clearance</label>
                            <input type="file" class="form-control" id="nbiImageUpload" >
                            <button type="button" class="btn btn-primary mt-4" onclick="viewFile()">View Uploaded File</button>
                        </div>
                        <div class="mb-3">
                            <label for="nbiImageUpload" class="form-label">Municipal Trial Court Clearance</label>
                            <input type="file" class="form-control" id="nbiImageUpload" >
                            <button type="button" class="btn btn-primary mt-4" onclick="viewFile()">View Uploaded File</button>
                        </div>
                        <div class="mb-3">
                            <label for="nbiImageUpload" class="form-label">Prosecutor’s Clearance</label>
                            <input type="file" class="form-control" id="nbiImageUpload" >
                            <button type="button" class="btn btn-primary mt-4" onclick="viewFile()">View Uploaded File</button>
                        </div>

                        <br>

                        <div class="col-lg-offset-0 col-lg-12 col-xs-12"> 
                            <i class="bi bi-info-circle-fill"></i>       
                            *Note:  File type should be JPG, JPEG, or PNG and 7MB maximum file size.
                        </div>
                    </form>
                </div>



                <div class="form-section" id="businessandOperationalDocuments" style="display: none;">
                    <form>
                        <h4>Business and Operational Documents</h4>
                        <div class="mb-3">      
                                <label for="nbiImageUpload" class="form-label">Previous Mayor’s Permit</label>
                                <input type="file" class="form-control" id="nbiImageUpload" >
                                <button type="button" class="btn btn-primary mt-4" onclick="viewFile()">View Uploaded File</button>
                        </div>
                        <div class="mb-3">
                            <label for="nbiImageUpload" class="form-label">Official Receipt for Mayor’s Permit</label>
                            <input type="file" class="form-control" id="nbiImageUpload" >
                            <button type="button" class="btn btn-primary mt-4" onclick="viewFile()">View Uploaded File</button>
                        </div>
                        <br>

                        <div class="col-lg-offset-0 col-lg-12 col-xs-12"> 
                            <i class="bi bi-info-circle-fill"></i>       
                            *Note:  File type should be JPG, JPEG, or PNG and 7MB maximum file size.
                        </div>
                    </form>
                </div>

    
                <!-- User Summary Section -->
                <div class="form-section" id="section6" style="display: none;">
                    <h4>User Summary</h4>
                    <form>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Identification Documents -->
                                <tr>
                                    <td><strong>Driver’s License:</strong></td>
                                    <td id="summaryDriversLicense"></td>
                                </tr>
                                <tr>
                                    <td><strong>2x2 Operator’s Picture:</strong></td>
                                    <td id="summaryOperatorPicture"></td>
                                </tr>
                
                                <!-- Community and Local Government Documents -->
                                <tr>
                                    <td><strong>Community Tax Certificate:</strong></td>
                                    <td id="summaryCommunityTaxCert"></td>
                                </tr>
                                <tr>
                                    <td><strong>Barangay Clearance:</strong></td>
                                    <td id="summaryBarangayClearance"></td>
                                </tr>
                                <tr>
                                    <td><strong>Voter’s Certificate:</strong></td>
                                    <td id="summaryVotersCert"></td>
                                </tr>
                
                                <!-- Legal and Court-Related Documents -->
                                <tr>
                                    <td><strong>Police Clearance:</strong></td>
                                    <td id="summaryPoliceClearance"></td>
                                </tr>
                                <tr>
                                    <td><strong>Municipal Trial Court Clearance:</strong></td>
                                    <td id="summaryMTClearance"></td>
                                </tr>
                                <tr>
                                    <td><strong>Prosecutor’s Clearance:</strong></td>
                                    <td id="summaryProsecutorClearance"></td>
                                </tr>
                
                                <!-- Business and Operational Documents -->
                                <tr>
                                    <td><strong>Previous Mayor’s Permit:</strong></td>
                                    <td id="summaryMayorsPermit"></td>
                                </tr>
                                <tr>
                                    <td><strong>Official Receipt for Mayor’s Permit:</strong></td>
                                    <td id="summaryOfficialReceipt"></td>
                                </tr>
                            </tbody>
                        </table>
                    </form>
                </div>
                

    
                <!-- Navigation Buttons -->
                <div class="navigation-buttons">
                    <button type="button" id="prev-btn" class="btn btn-secondary" style="display: none;">Previous</button>
                    <button type="button" id="next-btn" class="btn btn-primary">Next</button>
                </div>
    
            </div>
        </div>
    </div>
    </main>

    <br>
    <br>
      <footer>
        <div class="container">
            <div class="row row-cols-1 row-cols-lg-3">
                    <ul class="list-inline my-2">
                        <li class="list-inline-item"><a class="link-secondary" href="#">About us</a></li>
                        <li class="list-inline-item"><a class="link-secondary" href="#">Services</a></li>
                        <li class="list-inline-item"><a class="link-secondary" href="#">Contact Us</a></li>
                    </ul>
                <div class="col">
                    <ul class="list-inline my-2">
                        <li class="list-inline-item me-4">
                            <div class="bs-icon-circle bs-icon-primary bs-icon"><svg class="bi bi-facebook" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"></path>
                                </svg></div>
                        </li>
                        <li class="list-inline-item me-4">
                            <div class="bs-icon-circle bs-icon-primary bs-icon"><svg class="bi bi-twitter" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"></path>
                                </svg></div>
                        </li>
                        <li class="list-inline-item">
                            <div class="bs-icon-circle bs-icon-primary bs-icon"><svg class="bi bi-instagram" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z"></path>
                                </svg></div>
                        </li>
                    </ul>
                </div>
                <div class="col">
                    <ul class="list-inline my-2">
                        <li class="list-inline-item"><a class="link-secondary" href="#">Privacy Policy</a></li>
                        <li class="list-inline-item"><a class="link-secondary" href="#">Terms of Use</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

<!-- User Agreement/Terms and Conditions Modal -->
<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content"> 
        <div class="modal-header">
          <h5 class="modal-title" id="termsModalLabel">User Agreement/Terms and Conditions</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>
            Please review the terms and conditions of using this service. By agreeing, you accept all legal obligations and
            terms outlined below.
          </p>
          <p>[Insert the full terms and conditions here...]</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Decline</button>
          <button type="button" class="btn btn-primary" id="acceptTermsBtn">I Agree</button>
        </div>
      </div>
    </div>
  </div>
  

    <script>
        // Toggle the visibility of the progress sidebar
        $("#progress-button").click(function() {
            $("#progress-menu").toggleClass('d-none');
        });
    
        // Function to populate user summary
        function populateSummary() {
            // Identification Documents
            const driversLicense = document.getElementById('nbiImageUpload').files.length > 0 ? "Uploaded" : "Not Provided";
            const operatorPicture = document.getElementById('nbiImageUpload').files.length > 0 ? "Uploaded" : "Not Provided";

            document.getElementById('summaryDriversLicense').innerText = driversLicense;
            document.getElementById('summaryOperatorPicture').innerText = operatorPicture;

            // Community and Local Government Documents
            const communityTaxCert = document.getElementById('nbiImageUpload').files.length > 0 ? "Uploaded" : "Not Provided";
            const barangayClearance = document.getElementById('nbiImageUpload').files.length > 0 ? "Uploaded" : "Not Provided";
            const votersCert = document.getElementById('nbiImageUpload').files.length > 0 ? "Uploaded" : "Not Provided";

            document.getElementById('summaryCommunityTaxCert').innerText = communityTaxCert;
            document.getElementById('summaryBarangayClearance').innerText = barangayClearance;
            document.getElementById('summaryVotersCert').innerText = votersCert;

            // Legal and Court-Related Documents
            const policeClearance = document.getElementById('nbiImageUpload').files.length > 0 ? "Uploaded" : "Not Provided";
            const mtClearance = document.getElementById('nbiImageUpload').files.length > 0 ? "Uploaded" : "Not Provided";
            const prosecutorClearance = document.getElementById('nbiImageUpload').files.length > 0 ? "Uploaded" : "Not Provided";

            document.getElementById('summaryPoliceClearance').innerText = policeClearance;
            document.getElementById('summaryMTClearance').innerText = mtClearance;
            document.getElementById('summaryProsecutorClearance').innerText = prosecutorClearance;

            // Business and Operational Documents
            const mayorsPermit = document.getElementById('nbiImageUpload').files.length > 0 ? "Uploaded" : "Not Provided";
            const officialReceipt = document.getElementById('nbiImageUpload').files.length > 0 ? "Uploaded" : "Not Provided";

            document.getElementById('summaryMayorsPermit').innerText = mayorsPermit;
            document.getElementById('summaryOfficialReceipt').innerText = officialReceipt;
        }


        // Navigation button logic
// Array of section IDs in the form
let currentSection = 0;
const sections = [
    "#identificationDocuments",
    "#communityandLocalGovernmentDocuments",
    "#legalandCourtRelatedDocuments",
    "#businessandOperationalDocuments",
    "#section6"
];

// Hide all sections except the first one
$(sections.slice(1).join(', ')).hide();

// Initialize button state
updateButtons();
updateProgress();

// Function to handle "Previous" button click
$("#prev-btn").click(function() {
    if (currentSection > 0) {
        $(sections[currentSection]).hide(); // Hide current section
        currentSection--; // Decrement section index
        $(sections[currentSection]).show(); // Show previous section
        updateIcon(currentSection + 1, "empty"); // Update progress icon
        updateButtons(); // Update buttons' visibility and text
        updateProgress(); // Update progress bar
    }
});



$("#next-btn").click(function() {
    const currentForm = $(sections[currentSection]).find('form')[0];
    if (currentForm && !currentForm.checkValidity()) {
        currentForm.reportValidity(); // Trigger form validation
        return;
    }

    if (currentSection < sections.length - 1) {
        $(sections[currentSection]).hide(); // Hide current section
        updateIcon(currentSection, "fill"); // Update progress icon for the current section

        currentSection++; // Increment section index

        // Show next section
        $(sections[currentSection]).show(); 
        updateButtons(); // Update buttons' visibility and text
        updateProgress(); // Update progress bar to reflect the new current section
        if (currentSection === 4) { // Summary section
            populateSummary(); 
        }
    } else {
        // Show the User Agreement/Terms and Conditions modal
        const termsModal = new bootstrap.Modal(document.getElementById('termsModal'));
        termsModal.show();
    }
});

// Handle modal acceptance
document.getElementById('acceptTermsBtn').addEventListener('click', function() {
    alert('Form submitted!');
    // Add form submission logic here if needed
});





// Update visibility and text of navigation buttons
function updateButtons() {
    $("#prev-btn").toggle(currentSection > 0);
    $("#next-btn").text(currentSection === sections.length - 1 ? "Submit" : "Next");
}

// Update progress icons based on the current section
function updateIcon(index, state) {
    const icon = $(".progress-item").eq(index).find("i");
    icon.toggleClass("bi-check-square-fill", state === "fill");
    icon.toggleClass("bi-check-square", state === "empty");
}

// Update progress bar to highlight the active section
function updateProgress() {
    $(".progress-item").removeClass("active");
    $(".progress-item").eq(currentSection).addClass("active");
}

// Handle click events on progress bar items
$(".progress-item").click(function() {
    const targetSection = $(this).data('target');
    $(".form-section").hide();
    $("#" + targetSection).show();
    currentSection = sections.indexOf("#" + targetSection);
    updateButtons();
    updateProgress();
});


              // Get the current date
        const today = new Date();
        const date = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);
        document.getElementById('currentDate').textContent = date;
    
        // Function to calculate age
        function calculateAge(birthDate) {
            const today = new Date();
            const birthDateObj = new Date(birthDate);
            let age = today.getFullYear() - birthDateObj.getFullYear();
            const monthDifference = today.getMonth() - birthDateObj.getMonth();
    
            // Adjust if birth date hasn't occurred yet this year
            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDateObj.getDate())) {
                age--;
            }
            return age;
        }
    
        const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]');
        const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl));
    
        // Event listener for when the date of birth is picked
        document.getElementById('birthDate').addEventListener('change', function() {
            const birthDate = this.value;
            const age = calculateAge(birthDate);
            document.getElementById('age').value = age;
        });
    
    
        // Drawing functionality for the signature
        (function() {
            // Get a regular interval for drawing to the screen
            window.requestAnimFrame = (function(callback) {
                return window.requestAnimationFrame || 
                    window.webkitRequestAnimationFrame ||
                    window.mozRequestAnimationFrame ||
                    window.oRequestAnimationFrame ||
                    window.msRequestAnimaitonFrame ||
                    function(callback) {
                        window.setTimeout(callback, 1000 / 60);
                    };
            })();
    
            var canvas = document.getElementById("sig-canvas");
            var ctx = canvas.getContext("2d");
            var drawing = false;
            var mousePos = { x: 0, y: 0 };
            var lastPos = mousePos;
    
            var sigText = document.getElementById("sig-dataUrl");
            var sigImage = document.getElementById("displaySignature");
            var clearBtn = document.getElementById("sig-clearBtn");
            var submitBtn = document.getElementById("sig-submitBtn");
    
            clearBtn.addEventListener("click", function() {
                clearCanvas();
                sigImage.setAttribute("src", ""); // Clear the drawn signature
                sigImage.style.display = 'none'; // Hide drawn signature
            });
    
            submitBtn.addEventListener("click", function() {
                var dataUrl = canvas.toDataURL();
                sigText.value = dataUrl;
                sigImage.setAttribute("src", dataUrl); // Set the drawn signature
                sigImage.style.display = 'block'; // Show drawn signature
    
                // Hide the uploaded signature if it exists
                const uploadedSignature = document.getElementById("uploadedSignatureIcon");
                uploadedSignature.style.display = 'none'; // Hide uploaded image
    
                hasDrawnImage = true; // Mark that we have a drawn image
            });
    
            canvas.addEventListener("mousedown", function(e) {
                drawing = true;
                lastPos = getMousePos(canvas, e);
            });
    
            canvas.addEventListener("mouseup", function() {
                drawing = false;
            });
    
            canvas.addEventListener("mousemove", function(e) {
                mousePos = getMousePos(canvas, e);
                renderCanvas();
            });
    
            function getMousePos(canvasDom, mouseEvent) {
                var rect = canvasDom.getBoundingClientRect();
                return {
                    x: mouseEvent.clientX - rect.left,
                    y: mouseEvent.clientY - rect.top
                };
            }
    
            function renderCanvas() {
                if (drawing) {
                    ctx.moveTo(lastPos.x, lastPos.y);
                    ctx.lineTo(mousePos.x, mousePos.y);
                    ctx.stroke();
                    lastPos = mousePos;
                }
            }
    
            function clearCanvas() {
                canvas.width = canvas.width; // Clears the canvas
            }
        })();
    
        // Allow for animation
        (function drawLoop() {
            requestAnimFrame(drawLoop);
            renderCanvas();
        })();
    
        function displayImage(input, imgElementId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgElement = document.getElementById(imgElementId);
                    imgElement.src = e.target.result;
                    imgElement.style.display = 'block'; // Show uploaded image
    
                    // Hide drawn image if it's visible
                    const drawnImage = document.getElementById("displaySignature");
                    drawnImage.style.display = 'none'; // Hide drawn image
                    hasDrawnImage = false; // Reset drawn image status
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
    
        function toggleImageUpload() {
            const checkboxes = [
                document.getElementById('flexCheckYellow'),
                document.getElementById('flexCheckAEP'),
                document.getElementById('flexCheckDPOS'),
                document.getElementById('flexCheckEmbalming'),
                document.getElementById('flexCheckParental'),
                document.getElementById('flexCheckBirth'),
                document.getElementById('flexCheckValidID'),
                document.getElementById('flexCheckWorkingChild')
            ];
    
            const fileInputContainer = document.getElementById('fileInputContainer');
            fileInputContainer.innerHTML = ''; // Clear previous inputs
    
            // Loop through checkboxes and add file inputs for each checked one
            checkboxes.forEach((checkbox, index) => {
                if (checkbox.checked) {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.className = 'form-control mb-3'; // Add margin for spacing
                    input.required = true;
                    input.id = `idImageUpload${index}`; // Unique ID for each file input
                    fileInputContainer.appendChild(input);
                }
            });
        }

        function viewFile() {
            const fileInput = document.getElementById('nbiImageUpload');
            if (fileInput.files.length > 0) {
                const fileURL = URL.createObjectURL(fileInput.files[0]);
                window.open(fileURL);  // Opens the uploaded file in a new tab
            } else {
                alert('No file uploaded.');
            }
        }
    </script>
</body>
</html>